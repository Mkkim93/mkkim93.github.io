<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Troubleshooting | MK Kim</title>
  <link rel="icon" href="favicon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>

  <button class="nav__toggle" onclick="toggleNav()" aria-label="메뉴 열기">
    <span></span><span></span><span></span>
  </button>
  <div class="nav__overlay" onclick="toggleNav()"></div>

  <nav class="nav">
    <div class="nav__profile">
      <img src="assets/images/profile.jpeg" alt="Profile" class="nav__avatar">
      <div class="nav__name">MK Kim</div>
      <div class="nav__role">백엔드 개발자</div>
    </div>
    <ul class="nav__links">
      <li><a href="index.html"><span class="nav__icon">~</span> Home</a></li>
      <li><a href="about.html"><span class="nav__icon">&amp;</span> About</a></li>
      <li><a href="projects.html"><span class="nav__icon">{}</span> Projects</a></li>
      <li><a href="troubleshooting.html" class="active"><span class="nav__icon">!</span> Troubleshooting</a></li>
    </ul>
    <div class="nav__footer">
      <a href="https://github.com/mkkim" class="nav__social" title="GitHub" target="_blank" rel="noopener">GH</a>
      <a href="mailto:mkkim@example.com" class="nav__social" title="Email">@</a>
    </div>
  </nav>

  <main class="main">

    <header class="page-header fade-in">
      <span class="page-header__tag">// troubleshooting</span>
      <h1 class="page-header__title">
        <span class="highlight">트러블슈팅</span> 기록
      </h1>
      <p class="page-header__sub">
        실무에서 마주친 문제들과 해결 과정을 기록합니다. 같은 실수를 반복하지 않기 위해.
      </p>
    </header>

    <!-- Case 1 -->
    <section class="section fade-in">
      <h2 class="section__title">DataTables 제거 마이그레이션</h2>

      <div class="timeline">
        <div class="timeline__item">
          <div class="timeline__date">2024</div>
          <span class="timeline__label timeline__label--problem">PROBLEM</span>
          <div class="timeline__title">DataTables 라이브러리 의존으로 인한 유지보수 비용 증가</div>
          <div class="timeline__content">
            <p>기존 백오피스 전체(102개 파일)가 jQuery DataTables에 의존하고 있었음.</p>
            <ul>
              <li>검색 시 테이블을 <code>destroy: true</code>로 파괴 후 재생성 &rarr; 성능 저하</li>
              <li><code>dataFilter</code>로 서버 응답을 DT 포맷에 맞게 변환하는 간접 레이어</li>
              <li><code>columnDefs.render</code>에서 XSS 방어 없이 raw HTML 삽입</li>
              <li>탭 전환 시 <code>columns.adjust()</code> 필수 &rarr; 의미 없는 코드 증가</li>
            </ul>
          </div>
        </div>

        <div class="timeline__item">
          <span class="timeline__label timeline__label--solution">SOLUTION</span>
          <div class="timeline__title">Ajax + 수동 렌더링 패턴으로 점진적 전환</div>
          <div class="timeline__content">
            <p>한 번에 모든 코드를 바꾸지 않고, 모듈 단위로 점진적으로 마이그레이션:</p>
            <pre><span style="color:#818cf8">function</span> loadList(page) {
  <span style="color:#818cf8">var</span> params = $(<span style="color:#34d399">'#searchForm'</span>).serialize();
  params += <span style="color:#34d399">'&page='</span> + (page || 1);

  $.post(url, params, <span style="color:#818cf8">function</span>(resp) {
    <span style="color:#818cf8">if</span> (resp.code === <span style="color:#34d399">'S000'</span>) {
      renderList(resp.list, resp.pageInfo);
      $(<span style="color:#34d399">'#pagination'</span>).html(resp.paginationHtml);
    }
  });
}</pre>
            <p><strong>핵심 변경:</strong></p>
            <ul>
              <li>서버에서 <code>PaginationRenderer</code>로 페이지네이션 HTML 생성</li>
              <li>모든 사용자 데이터에 <code>escapeHtml()</code> 적용</li>
              <li>검색 시 Ajax replace만 수행 &rarr; 재초기화 오버헤드 제거</li>
            </ul>

            <p><strong>결과:</strong> 44/102 파일 마이그레이션 완료, 코드 가독성 대폭 향상</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Case 2 -->
    <section class="section fade-in">
      <h2 class="section__title">N+1 쿼리 문제</h2>

      <div class="timeline">
        <div class="timeline__item">
          <div class="timeline__date">예시</div>
          <span class="timeline__label timeline__label--problem">PROBLEM</span>
          <div class="timeline__title">목록 조회 시 느린 응답 속도</div>
          <div class="timeline__content">
            <p>가맹점 목록 조회 API에서 응답 시간이 비정상적으로 느려지는 현상 발생.</p>
            <pre><span style="color:#64748b">-- 원인: 각 가맹점마다 브랜드 정보를 개별 조회</span>
SELECT * FROM franchisee;
<span style="color:#64748b">-- 결과 100건이면 아래가 100번 실행</span>
SELECT * FROM brand WHERE brand_id = ?;</pre>
          </div>
        </div>

        <div class="timeline__item">
          <span class="timeline__label timeline__label--solution">SOLUTION</span>
          <div class="timeline__title">JOIN 쿼리로 변경</div>
          <div class="timeline__content">
            <p>MyBatis 매퍼에서 단일 JOIN 쿼리로 변경하여 N+1 문제 해결:</p>
            <pre>SELECT
  f.*,
  b.brand_name
FROM franchisee f
<span style="color:#818cf8">LEFT JOIN</span> brand b
  <span style="color:#818cf8">ON</span> f.brand_id = b.brand_id
<span style="color:#818cf8">WHERE</span> f.use_yn = <span style="color:#34d399">'Y'</span>
<span style="color:#818cf8">LIMIT</span> #{offset}, #{limit};</pre>
            <p><strong>결과:</strong> 쿼리 101회 &rarr; 1회로 감소, 응답 시간 대폭 개선</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Case 3 -->
    <section class="section fade-in">
      <h2 class="section__title">엑셀 다운로드 OOM 이슈</h2>

      <div class="timeline">
        <div class="timeline__item">
          <div class="timeline__date">예시</div>
          <span class="timeline__label timeline__label--problem">PROBLEM</span>
          <div class="timeline__title">대용량 엑셀 다운로드 시 OutOfMemoryError</div>
          <div class="timeline__content">
            <p>10만 건 이상의 데이터를 엑셀로 내보낼 때 서버 메모리 부족 발생.</p>
            <pre><span style="color:#f87171">java.lang.OutOfMemoryError: Java heap space</span>
  at org.apache.poi.xssf.usermodel.XSSFWorkbook...</pre>
            <p>원인: <code>XSSFWorkbook</code>은 전체 데이터를 메모리에 올린 후 파일 생성.</p>
          </div>
        </div>

        <div class="timeline__item">
          <span class="timeline__label timeline__label--solution">SOLUTION</span>
          <div class="timeline__title">SXSSFWorkbook 스트리밍 방식 적용</div>
          <div class="timeline__content">
            <p>Apache POI의 스트리밍 API로 교체하여 메모리 사용량 제한:</p>
            <pre><span style="color:#64748b">// 메모리에 100행만 유지, 나머지는 디스크에 임시 저장</span>
<span style="color:#818cf8">SXSSFWorkbook</span> workbook =
  <span style="color:#818cf8">new</span> SXSSFWorkbook(<span style="color:#34d399">100</span>);
workbook.setCompressTempFiles(<span style="color:#34d399">true</span>);</pre>
            <p><strong>결과:</strong> 메모리 사용량 90% 감소, 30만 건까지 안정적 다운로드 가능</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Template -->
    <section class="section fade-in">
      <h2 class="section__title">Template</h2>

      <div class="timeline">
        <div class="timeline__item" style="border-style: dashed;">
          <div class="timeline__date">날짜를 입력하세요</div>
          <span class="timeline__label timeline__label--problem">PROBLEM</span>
          <div class="timeline__title">문제 제목을 입력하세요</div>
          <div class="timeline__content">
            <p>어떤 현상이 발생했는지, 어떤 환경에서 발생했는지 설명합니다.</p>
          </div>
        </div>

        <div class="timeline__item" style="border-style: dashed;">
          <span class="timeline__label timeline__label--solution">SOLUTION</span>
          <div class="timeline__title">해결 방법을 입력하세요</div>
          <div class="timeline__content">
            <p>원인 분석 과정과 적용한 해결 방법, 그리고 결과를 작성합니다.</p>
          </div>
        </div>
      </div>
    </section>

    <footer class="footer">
      <p>&copy; 2026 MK Kim. Built with HTML &amp; CSS.</p>
    </footer>

  </main>

  <script>
    function toggleNav() {
      document.querySelector('.nav').classList.toggle('open');
      document.querySelector('.nav__overlay').classList.toggle('open');
    }
  </script>

</body>
</html>
